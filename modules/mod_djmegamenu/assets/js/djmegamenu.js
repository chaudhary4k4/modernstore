/**
 * @version $Id: djmegamenu.js 26 2014-12-02 02:21:41Z szymon $
 * @package DJ-MegaMenu
 * @copyright Copyright (C) 2013 DJ-Extensions.com, All rights reserved.
 * @license DJ-Extensions.com Proprietary Use License
 * @author url: http://dj-extensions.com
 * @author email contact@dj-extensions.com
 * @developer Szymon Woronowski - szymon.woronowski@design-joomla.eu
 */
!function(e){var t=this.DJMegaMenu=function(e,t){this.options={delay:500,animIn:"fadeIn",animOut:"fadeOut",animSpeed:"normal",duration:450,wrap:null,direction:"ltr",event:"mouseenter",touch:"ontouchstart"in window||navigator.MaxTouchPoints>0||navigator.msMaxTouchPoints>0},this.init(e,t)};t.prototype.init=function(t,o){var s=this;if(s.options=Object.merge(s.options,o),t){switch(s.options.direction=window.getComputedStyle(document.body).getPropertyValue("direction"),s.options.animSpeed){case"fast":s.options.duration=250;break;case"slow":s.options.duration=650}t.addClass(s.options.animSpeed);var n=t.getChildren("li.dj-up");s.kids=[],s.options.wrap=s.options.wrap?e(s.options.wrap):t,n.each(function(e,t){s.kids[t]=new i(e,0,s,s.options)}),s.options.fixed&&!s.options.touch&&window.addEvent("load",s.makeSticky.bind(s,t))}},t.prototype.makeSticky=function(e){var t=this;t.sticky=!1;var i=new Element("div",{id:e.get("id")+"sticky"});i.addClass("dj-megamenu"),i.addClass("dj-megamenu-"+t.options.theme),i.addClass("dj-megamenu-sticky"),i.setStyles({position:"fixed",top:t.options.offset,left:0,width:"100%"});var o=e.getPosition().y-t.options.offset,s=e.clone(!0);s.set("id",e.get("id")+"placeholder"),s.setStyle("opacity",0);var n="rtl"==t.options.direction?"right":"left";window.addEvent("scroll",t.scroll.bind(t,[i,e,s,o,n,!1])),window.addEvent("resize",t.scroll.bind(t,[i,e,s,o,n,!0]))},t.prototype.scroll=function(e,t,i,o,s,n){var a=this;if(window.getScroll().y>o)if(a.sticky){if(n){var r=i.getCoordinates(),l="left"==s?r.left:window.getSize().x-r.left-r.width;t.setStyle(s,l)}}else{var r=t.getCoordinates(),l="left"==s?r.left:window.getSize().x-r.left-r.width;t.setStyle(s,l),i.inject(t,"before"),e.wraps(t),a.sticky=!0}else a.sticky&&(t.replaces(i),t.setStyle(s,""),e.dispose(),a.sticky=!1)};var i=function(e,t,i,o){this.options={},this.init(e,t,i,o)};i.prototype.init=function(e,t,i,o){var s=this;s.options=Object.merge(s.options,o),s.menu=e,s.level=t,s.parent=i,s.timer=null,s.sub=e.getElement(".dj-subwrap");var n="mouseenter";if(s.options.touch||"click_all"==s.options.event){n="click";var a=e.getElement("a");a&&a.getParent()==e&&(e.hasClass("separator")&&a.setStyle("cursor","pointer"),a.addEvent("click",function(e){s.sub&&!s.menu.hasClass("hover")&&e.preventDefault()}))}else if("click"==s.options.event&&e.hasClass("separator")){var a=e.getElement("a");a&&a.getParent()==e&&a.setStyle("cursor","pointer"),n="click"}s.menu.addEvent(n,s.showSub.bind(s)),s.menu.addEvent("mouseleave",s.hideSub.bind(s)),s.sub&&(s.kids=[],s.initKids())},i.prototype.showSub=function(){var e=this;clearTimeout(e.timer),(!e.menu.hasClass("hover")||e.sub.hasClass(e.options.animOut))&&(clearTimeout(e.animTimer),e.menu.addClass("hover"),e.sub&&!e.DirDone&&e.checkDir(),e.hideOther(),e.sub&&(e.sub.removeClass(e.options.animOut),e.sub.addClass(e.options.animIn)))},i.prototype.hideSub=function(){var e=this;e.sub?e.timer=setTimeout(function(){e.sub.removeClass(e.options.animIn),e.sub.addClass(e.options.animOut),e.animTimer=setTimeout(function(){e.menu.removeClass("hover")},e.options.duration)},e.options.delay):e.menu.removeClass("hover")},i.prototype.checkDir=function(){var t=this;t.DirDone=!0;var i=t.sub.getCoordinates(),o=t.options.wrap.getCoordinates();if(t.options.wrap.hasClass("dj-megamenu")){var s=e(t.options.wrap.get("id")+"placeholder");s&&(o=s.getCoordinates())}if("ltr"==t.options.direction){var n=i.left+i.width-o.width-o.left;n>0&&(t.level?(t.sub.setStyle("right",t.menu.getSize().x),t.sub.setStyle("left","auto")):t.sub.setStyle("margin-left",-n))}else if("rtl"==t.options.direction){var n=i.left-o.left;0>n&&(t.level?(t.sub.setStyle("left",t.menu.getSize().x),t.sub.setStyle("right","auto")):t.sub.setStyle("margin-right",n))}},i.prototype.initKids=function(){var e=this,t=e.sub.getChildren(".dj-subwrap-in > .dj-subcol > ul.dj-submenu > li");t.each(function(t,o){e.kids[o]=new i(t,e.level+1,e,e.options)})},i.prototype.hideOther=function(){var e=this;e.parent.kids.each(function(t){t.menu.hasClass("hover")&&t!=e&&(t.sub?(t.hideOtherSub(),t.sub.removeClass(t.options.animIn),t.sub.addClass(t.options.animOut),t.animTimer=setTimeout(function(){t.menu.removeClass("hover")},e.options.duration)):t.menu.removeClass("hover"))})},i.prototype.hideOtherSub=function(){var e=this;e.kids.each(function(e){e.sub&&(e.hideOtherSub(),e.sub.removeClass(e.options.animIn),e.sub.removeClass(e.options.animOut)),e.menu.removeClass("hover")})}}(document.id);